{
  "info": {
    "name": "CollabSync-DocumentService",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Collection for testing the Document Service API endpoints"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:4002",
      "type": "string"
    },
    {
      "key": "jwt",
      "value": "",
      "type": "string"
    },
    {
      "key": "docId",
      "value": "",
      "type": "string"
    },
    {
      "key": "docVersion",
      "value": "1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "ðŸ”‘ Authentication",
      "item": [
        {
          "name": "Set JWT Token",
          "request": {
            "method": "GET",
            "header": [],
            "url": null
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// This is a helper request to manually set JWT token",
                  "// You need to paste a valid JWT token in the 'Current Value' field of the jwt variable",
                  "// Or you can use the user-service to generate a token",
                  "console.log('Current JWT token: ' + pm.variables.get('jwt'));"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ðŸ“„ Document Operations",
      "item": [
        {
          "name": "Create Document",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"title\": \"Test Document\",\n    \"content\": \"This is a test document content.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Document created successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"success\");",
                  "    pm.expect(jsonData.data).to.have.property(\"_id\");",
                  "    pm.expect(jsonData.data).to.have.property(\"title\");",
                  "    pm.expect(jsonData.data).to.have.property(\"content\");",
                  "    pm.expect(jsonData.data).to.have.property(\"version\");",
                  "    ",
                  "    // Save document ID and version for later use",
                  "    pm.collectionVariables.set(\"docId\", jsonData.data._id);",
                  "    pm.collectionVariables.set(\"docVersion\", jsonData.data.version);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Documents",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response contains documents array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"success\");",
                  "    pm.expect(jsonData.data).to.be.an(\"array\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Document by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents/{{docId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents", "{{docId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Document retrieved successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"success\");",
                  "    pm.expect(jsonData.data).to.have.property(\"_id\");",
                  "    pm.expect(jsonData.data._id).to.eql(pm.collectionVariables.get(\"docId\"));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Document",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"title\": \"Updated Document\",\n    \"content\": \"This document has been updated.\",\n    \"version\": {{docVersion}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents/{{docId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents", "{{docId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Document updated successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"success\");",
                  "    pm.expect(jsonData.data).to.have.property(\"_id\");",
                  "    pm.expect(jsonData.data).to.have.property(\"version\");",
                  "    ",
                  "    // Update document version for later use",
                  "    pm.collectionVariables.set(\"docVersion\", jsonData.data.version);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Delete Document",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents/{{docId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents", "{{docId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Document deleted successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"success\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ðŸ”„ Optimistic Concurrency",
      "item": [
        {
          "name": "Version Conflict Test",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"title\": \"Conflict Document\",\n    \"content\": \"This update should fail due to version conflict.\",\n    \"version\": \"1\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents/{{docId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents", "{{docId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 409 (Conflict)\", function () {",
                  "    pm.response.to.have.status(409);",
                  "});",
                  "",
                  "pm.test(\"Version conflict error returned\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"error\");",
                  "    pm.expect(jsonData.message).to.include(\"version conflict\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ðŸš« Error Scenarios",
      "item": [
        {
          "name": "Invalid Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer invalid.token.here"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"title\": \"Test Document\",\n    \"content\": \"This request should fail due to invalid token.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 403 (Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});",
                  "",
                  "pm.test(\"Invalid token error returned\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"error\");",
                  "    pm.expect(jsonData.message).to.include(\"Invalid token\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "No Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"title\": \"Test Document\",\n    \"content\": \"This request should fail due to missing token.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 403 (Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});",
                  "",
                  "pm.test(\"No token error returned\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"error\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Document Not Found",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/documents/60f1a5b5c2e5a83e9c9d1234",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "documents", "60f1a5b5c2e5a83e9c9d1234"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 404 (Not Found)\", function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test(\"Document not found error returned\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"error\");",
                  "    pm.expect(jsonData.message).to.include(\"not found\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ]
}